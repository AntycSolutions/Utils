{% extends 'utils/base/html_base.html' %}

{% load static %}

{% block head_scripts %}
    {{ block.super }}

    {% if settings.UTILS.fallback %}
        {# fallback js #}
        <script async src="//cdnjs.cloudflare.com/ajax/libs/fallback/1.1.8/fallback.min.js" type="text/javascript" onload="load_fallback();" onerror="fallback_fallback();"></script>
        <script type="text/javascript">
            function fallback_fallback() {
                if (typeof fallback === 'undefined') {
                    var fallback_script = document.createElement('script');
                    fallback_script.type = "text/javascript";
                    fallback_script.src = "{% static 'utils/js/fallback.min.js' %}";
                    fallback_script.onload = load_fallback; // IE 8+
                    fallback_script.onerror = function() {
                        window.alert(
                            'Failed to load required resource (FallbackJS), please refresh the page or contact an administrator ('
                            {% for admin in settings.ADMINS %}
                                + '{{ admin.1 }}'
                            {% endfor %}
                            + ')'
                        );
                    }
                    var head = document.head; // IE 9+
                    head.appendChild(fallback_script);
                }
            }

            function load_fallback() {
                fallback.load(
                    // css/js
                    {
                        {% block fallback_load %}
                            // css
                            // key/str: list of str/str

                            // js
                            // THE KEY MUST BE THE LIBRARIES WINDOW VARIABLE!
                            // key/str: list of str/str
                        {% endblock %}
                    },
                    // options
                    {
                        shim: {
                            {% block fallback_shim %}
                                // key/str: list of str
                            {% endblock %}
                        }
                    }
                );

                // fallback.ready(['jQuery'], function() {
                // });

                fallback.ready(function() {
                    {% block fallback_ready %}
                        // internal js
                    {% endblock %}
                });
            }
        </script>
    {% endif %}
{% endblock %}
