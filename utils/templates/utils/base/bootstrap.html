{% extends 'utils/base/fallback.html' %}

{% load static %}

{% if settings.UTILS.bootstrap3 %}
    {% block meta %}
        {{ block.super }}

        {% block bootstrap_meta %}
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
        {% endblock %}
    {% endblock %}

    {% block head %}
        {{ block.super }}

        {% block bootstrap_head %}
            {# HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries #}
            {# WARNING: Respond.js doesn't work if you view the page via file:// #}
            {# TODO: how to fallback these? #}
            <!--[if lt IE 9]>
                <script src="//oss.maxcdn.com/html5shiv/{{ utils_settings.VERSIONS.html5shiv_js }}/html5shiv.min.js" type="text/javascript"></script>
                <script src="//oss.maxcdn.com/respond/{{ utils_settings.VERSIONS.respond_js }}/respond.min.js" type="text/javascript"></script>
            <![endif]-->
        {% endblock %}
    {% endblock %}

    {% block styles %}
        {{ block.super }}

        <style type="text/css">
            .inline {
                {% comment %}
                    form-static and other inline elements rely on the
                     whitespace that our minifier removes
                {% endcomment %}
                margin-right: 4px;
            }
        </style>
    {% endblock %}

    {% if settings.UTILS.fallback %}
        <script type="text/javascript">
            {% block fallback_load %}
                {{ block.super }}

                {% block bootstrap_fallback_load %}
                    {% block bootstrap_fallback_load_css %}
                        bootstrap_css: [
                            '//maxcdn.bootstrapcdn.com/bootstrap/{{ utils_settings.VERSIONS.bootstrap_css }}/css/bootstrap.min.css',
                            "{% static 'utils/css/bootstrap.min.css' %}"
                        ],
                    {% endblock %}

                    jQuery: [
                        '//code.jquery.com/jquery-{{ utils_settings.VERSIONS.jquery_js }}.min.js',
                        "{% static 'utils/js/jquery.min.js' %}"
                    ],

                    'jQuery.fn.modal': [ // bootstrap
                        '//maxcdn.bootstrapcdn.com/bootstrap/{{ utils_settings.VERSIONS.bootstrap_js }}/js/bootstrap.min.js',
                        "{% static 'utils/js/bootstrap.min.js' %}"
                    ],
                {% endblock %}
            {% endblock %}

            {% block fallback_shim %}
                {{ block.super }}

                {% block bootstrap_fallback_shim %}
                    'jQuery.fn.modal': ['jQuery'],
                {% endblock %}
            {% endblock %}

            {% block fallback_ready %}
                {{ block.super }}

                function responsive_btn_group() {
                    $('.btn-group').each(function() {
                        var $this = $(this);
                        var width = 0;
                        $this.find('.btn').each(function() {
                            width += $(this).width();
                        });
                        var btn_group = 'btn-group';
                        var btn_group_vertical = 'btn-group-vertical';
                        if (width > $(window).width()) {
                            $this.removeClass(btn_group);
                            $this.addClass(btn_group_vertical);
                        } else {
                            $this.addClass(btn_group);
                            $this.removeClass(btn_group_vertical);
                        }
                    });
                }
                $(document).ready(function() {
                    responsive_btn_group();
                    $(window).resize(responsive_btn_group);
                });
            {% endblock %}
        </script>
    {% else %}
        {# TODO: handle non-fallback #}
    {% endif %}
{% endif %}
